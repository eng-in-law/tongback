<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³€í˜¸ì‚¬ì‹œí—˜ ë‹µì•ˆ ì‘ì„± ì‹œë®¬ë ˆì´í„° (CBT ê¸°ì¤€)</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --secondary-color: #f8f9fa;
            --border-color: #dee2e6;
            --text-color: #212529;
            --muted-color: #6c757d;
            --success-bg: #d4edda;
            --success-text: #155724;
            --danger-bg: #f8d7da;
            --danger-text: #721c24;
            --warning-bg: #fff3cd;
            --warning-text: #856404;
            --monospace-font: "Nanum Gothic Coding", Consolas, 'Courier New', monospace; /* ë‚˜ëˆ”ê³ ë”•ì½”ë”© í•„ìˆ˜ */
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Malgun Gothic", "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
             /* Increased max-width significantly to allow wider textarea based on larger cols */
            max-width: 1100px;
            margin: 20px auto;
            padding: 25px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: #ffffff;
            color: var(--text-color);
            font-size: 16px;
        }
        h1 { text-align: center; color: var(--primary-color); margin-bottom: 10px;}
        h2 { text-align: center; color: #333; margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;}
        .description { text-align: center; font-size: 0.9em; color: var(--muted-color); margin-bottom: 25px; }
        label { display: block; margin-top: 15px; margin-bottom: 5px; font-weight: bold; font-size: 0.9em; color: #555;}
        .textarea-container { margin-bottom: 10px; }
        textarea {
            /* === Visual Wrapping Logic - Using adjusted cols attribute === */
            font-family: var(--monospace-font); /* Monospace Font is essential */
            /* width: auto; /* Let cols determine width */
            /* Removed width: calc(...) */
            /* Removed width: 49ch; */
            /* ========================================================== */
            min-height: 450px;
            height: 60vh;
            margin-top: 5px;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 15px; /* Font size affects visual width */
            line-height: 1.65;
            background-color: #fff;
            color: #333;
            overflow-wrap: break-word;
            white-space: pre-wrap;
            box-sizing: border-box; /* Keep this */
             overflow-x: hidden; /* Prevent horizontal scrollbar if cols makes it too wide */
        }
        .textarea-note { font-size: 0.85em; color: var(--warning-text); background-color: var(--warning-bg); margin-top: 5px; display: block; padding: 8px; border: 1px solid #ffeeba; border-radius: 4px; }
        textarea::placeholder { font-style: italic; color: #aaa; }
        input[type=number] {
            width: 180px; margin-top: 5px; padding: 10px; font-size: 1em;
            border: 1px solid #ced4da; border-radius: 4px; box-sizing: border-box;
        }
        .input-grid { display: flex; justify-content: center; margin-bottom: 25px; }
        .input-group { margin-bottom: 0; }
        .input-group small { font-size: 0.8em; color: var(--muted-color); display: block; margin-top: 3px;}
        button {
            display: block; width: 100%; max-width: 400px; margin: 30px auto 0 auto;
            padding: 14px 20px; cursor: pointer; background-color: var(--primary-color);
            color: white; border: none; border-radius: 5px; font-size: 1.15em;
            font-weight: bold; transition: background-color 0.2s ease;
        }
        button:hover { background-color: #004494; }

        /* Results Area */
        .results-container { margin-top: 35px; background-color: var(--secondary-color); padding: 25px; border: 1px solid var(--border-color); border-radius: 8px; }
        .results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .result-item { background-color: #fff; padding: 18px; border-radius: 6px; border: 1px solid #e9ecef; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .result-item h3 { margin-top: 0; font-size: 1.05em; color: var(--primary-color); margin-bottom: 12px; border-bottom: 1px solid #f0f0f0; padding-bottom: 8px; }
        .result-item p { margin: 8px 0; font-size: 1em; line-height: 1.6; color: #343a40; }
        .result-item strong { font-size: 1.1em; color: var(--text-color); }
        .result-item ul { padding-left: 20px; margin-top: 5px; margin-bottom: 10px;}
        .result-item li { margin-bottom: 5px; }
        .error { color: var(--danger-text); font-weight: bold; margin: 20px 0; text-align: center; background-color: var(--danger-bg); padding: 12px; border: 1px solid #f5c6cb; border-radius: 4px; }
        /* Comparison span styles */
        .efficiency-result { font-weight: bold; padding: 3px 6px; border-radius: 4px; display: inline-block; margin-left: 5px; }
        .time-available { background-color: var(--success-bg); color: var(--success-text); }
        .time-exceeded { background-color: var(--danger-bg); color: var(--danger-text); }
        .note { display: block; margin-top: 8px; font-size: 0.85em; color: var(--muted-color); line-height: 1.4;}

    </style>
    <!-- Ensure Nanum Gothic Coding font is loaded -->
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&display=swap" rel="stylesheet">
</head>
<body>
    <h1>ë³€í˜¸ì‚¬ì‹œí—˜ ë‹µì•ˆ ì‘ì„± ì‹œë®¬ë ˆì´í„° (CBT ê¸°ì¤€)</h1>
    <p class="description">
        ë‹µì•ˆ í…ìŠ¤íŠ¸ì™€ íƒ€ì ì†ë„ë¥¼ ì…ë ¥í•˜ì—¬ ì˜ˆìƒ ì†Œìš” ì‹œê°„, ë‹µì•ˆ ë¶„ëŸ‰, ë¶„ëŸ‰ ê¸°ì¤€ í‘œì¤€ ì‹œê°„, ê·¸ë¦¬ê³  í™•ë³´ ê°€ëŠ¥í•œ ì‚¬ê³ /êµ¬ìƒ ì‹œê°„ ë“±ì„ ê³„ì‚°í•©ë‹ˆë‹¤.<br>
        â€» ë‹µì•ˆì§€ ê¸°ì¤€ (CBT ê·¼ì‚¬ì¹˜): ì¤„ ë‹¹ <strong>{{ chars_per_line_const }}</strong>ì (ìŒì ˆ ê¸°ì¤€), í˜ì´ì§€ ë‹¹ <strong>{{ lines_per_page_const }}</strong>ì¤„, 100ì  ë‹¹ <strong>{{ '%d'|format(lines_per_100_points_const) }}</strong>ì¤„ / <strong>{{ '%d'|format(minutes_per_100_points_const) }}</strong>ë¶„
    </p>

    {% if error %}
        <p class="error">{{ error }}</p>
    {% endif %}

    <form method="post">
        <div class="textarea-container">
            <label for="text_input">ë‹µì•ˆ í…ìŠ¤íŠ¸ ì…ë ¥:</label>
            <!-- Using adjusted cols="89" based on empirical estimation (49 * (49/27)) -->
            <!-- This is a GUESS and might need further adjustment -->
            <textarea id="text_input" name="text_input" required cols="89" placeholder="ì—¬ê¸°ì— ë³€í˜¸ì‚¬ì‹œí—˜ ë‹µì•ˆ ë‚´ìš©ì„ ì…ë ¥í•˜ê±°ë‚˜ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”...">{{ text_input or '' }}</textarea>
            <!-- VERY IMPORTANT NOTE -->
            <span class="textarea-note"><strong>âš ï¸ ì‹œê°ì  ì¤„ë°”ê¿ˆ ì•ˆë‚´:</strong> ê³ ì •í­ ê¸€ê¼´('ë‚˜ëˆ”ê³ ë”•ì½”ë”©') ì‚¬ìš© ì‹œ, í•œ ì¤„ì— ì•½ {{ chars_per_line_const }}ê°œì˜ í•œê¸€ ìŒì ˆì´ ë³´ì´ë„ë¡ <strong>ë„ˆë¹„ë¥¼ ê²½í—˜ì ìœ¼ë¡œ ì¡°ì •(cols=89 ì¶”ì •)</strong>í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì‚¬ìš©ìì˜ ë¸Œë¼ìš°ì €, OS, ê¸€ê¼´ ë Œë”ë§ ë°©ì‹ì— ë”°ë¼ <strong>ì‹¤ì œ ë³´ì´ëŠ” ê¸€ì ìˆ˜ì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë©° ì™„ë²½í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</strong> ì‹œê°ì ì¸ ë¶€ë¶„ì€ ì°¸ê³ ìš©ì´ë©°, <strong>ëª¨ë“  ê³„ì‚°(ì˜ˆìƒ ì¤„ ìˆ˜, í˜ì´ì§€ ìˆ˜ ë“±)ì€ ì…ë ¥ëœ í…ìŠ¤íŠ¸ ê¸°ì¤€, ìŒì ˆ ìˆ˜ {{ chars_per_line_const }}ì ì´ˆê³¼ ì‹œ ë˜ëŠ” ì—”í„° ì…ë ¥ ì‹œ ë‹¤ìŒ ì¤„ë¡œ ë„˜ì–´ê°€ëŠ” ê²ƒì„ ê¸°ì¤€ìœ¼ë¡œ ì •í™•í•˜ê²Œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.</strong></span>
        </div>

        <div class="input-grid">
            <div class="input-group">
                <label for="typing_speed">íƒ€ì ì†ë„ (íƒ€ìˆ˜ - ë¶„ë‹¹ ê¸€ì ìˆ˜):</label>
                <input type="number" id="typing_speed" name="typing_speed" min="1" required placeholder="ì˜ˆ: 450" value="{{ typing_speed or '' }}">
            </div>
        </div>

        <div>
            <button type="submit">ê²°ê³¼ ê³„ì‚°í•˜ê¸°</button>
        </div>
    </form>

    {% if calculation_done %}
    <div class="results-container">
        <h2>ğŸ“Š ê³„ì‚° ê²°ê³¼</h2>
        <div class="results-grid">

            <!-- Volume Metrics -->
            <div class="result-item">
                <h3>ë‹µì•ˆ ë¶„ëŸ‰ ë¶„ì„</h3>
                <p>ì´ ê¸€ì ìˆ˜: <strong>{{ char_count }}</strong> ì</p>
                <p>ì˜ˆìƒ ì¤„ ìˆ˜ ({{ chars_per_line_const }}ìŒì ˆ/ì¤„ ê¸°ì¤€): <strong>{{ estimated_lines }}</strong> ì¤„</p>
                <p>ì˜ˆìƒ í˜ì´ì§€ ìˆ˜ ({{ lines_per_page_const }}ì¤„/í˜ì´ì§€ ê¸°ì¤€): <strong>{{ "%.1f"|format(estimated_pages) }}</strong> í˜ì´ì§€</p>
                <p>ì˜ˆìƒ ë°°ì  ë¶„ëŸ‰: <strong>{{ "%.1f"|format(estimated_score) }}</strong> ì </p>
            </div>

            <!-- Time Metrics -->
            <div class="result-item">
                 <h3>ì˜ˆìƒ ì‹œê°„ ë¶„ì„</h3>
                 <p>â‘  ìˆœìˆ˜ íƒ€ì´í•‘ ì†Œìš” ì‹œê°„:</p>
                 <ul>
                    <li><strong>{{ typing_time_minutes }}ë¶„ {{ "{:.0f}".format(typing_time_remainder_seconds) }}ì´ˆ</strong></li>
                    <li>(ì´ {{ "%.2f"|format(typing_time_total_seconds) }} ì´ˆ)</li>
                 </ul>
                 <p>â‘¡ í•´ë‹¹ ë¶„ëŸ‰ ê¸°ì¤€ í‘œì¤€ ì‹œê°„:</p>
                 <ul>
                     <li><strong>{{ standard_time_minutes }}ë¶„ {{ "{:.0f}".format(standard_time_remainder_seconds) }}ì´ˆ</strong></li>
                     <li>({{ "%.1f"|format(estimated_score) }}ì  ê¸°ì¤€)</li>
                 </ul>
            </div>

             <!-- Efficiency/Thinking Time Analysis -->
            <div class="result-item">
                <h3>â³ ì‹œê°„ íš¨ìœ¨ì„± ë¶„ì„ (ê¸°ì¤€ ì‹œê°„ ëŒ€ë¹„)</h3>
                 {% if diff_vs_standard_seconds is not none %}
                    {% if diff_vs_standard_seconds >= 0 %}
                        <p>âœ… í™•ë³´ëœ ì‚¬ê³ /êµ¬ìƒ ì‹œê°„ (ì¶”ì •):
                            <span class="efficiency-result time-available">
                                {{ diff_vs_standard_minutes_abs }}ë¶„ {{ "{:.0f}".format(diff_vs_standard_seconds_abs) }}ì´ˆ
                            </span>
                        </p>
                        <span class="note">í•´ë‹¹ ë¶„ëŸ‰ì˜ í‘œì¤€ ì‹œê°„ ë‚´ì—ì„œ, ìˆœìˆ˜ íƒ€ì´í•‘ ì‹œê°„ì„ ì œì™¸í•˜ê³  ë¬¸ì œ ë…í•´, ìƒê°, ê²€í†  ë“±ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì˜ˆìƒ ì‹œê°„ì…ë‹ˆë‹¤.</span>
                    {% else %}
                         <p>âŒ íƒ€ì´í•‘ë§Œìœ¼ë¡œ ê¸°ì¤€ ì‹œê°„ ì´ˆê³¼:
                            <span class="efficiency-result time-exceeded">
                                {{ diff_vs_standard_minutes_abs }}ë¶„ {{ "{:.0f}".format(diff_vs_standard_seconds_abs) }}ì´ˆ ë¶€ì¡±
                            </span>
                        </p>
                         <span class="note">í•´ë‹¹ ë¶„ëŸ‰ì„ í‘œì¤€ ì‹œê°„ ë‚´ì— ì‘ì„±í•˜ê¸°ì—ëŠ” ìˆœìˆ˜ íƒ€ì´í•‘ ì‹œê°„ë§Œìœ¼ë¡œë„ ë¶€ì¡±í•©ë‹ˆë‹¤. íƒ€ì ì†ë„ë¥¼ ë†’ì´ê±°ë‚˜ ë‹µì•ˆ ë¶„ëŸ‰ì„ ì¡°ì ˆí•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
                    {% endif %}
                 {% else %}
                     <p style="color: var(--muted-color); font-style: italic;">(ë¶„ëŸ‰ì´ ì—†ì–´ ì‹œê°„ ë¹„êµ ë¶ˆê°€)</p>
                 {% endif %}
            </div>

        </div>
    </div>
    {% endif %}

</body>
</html>
